## 基本方針

- **言語**: コメント、ドキュメント、コミットメッセージ、PR の説明など、すべてのテキストは原則として**日本語**を使用します。ただし、コードの命名（変数名、関数名など）は英語（キャメルケース、パスカルケース）とします。
- **AI による操作**: AI アシスタント（Gemini）は、ファイルの変更後に自動でコミットやプッシュを行いません。すべての Git 操作は、ユーザーからの明確な指示と許可を得てから実行します。
- **ファイル読み込み**: プロジェクトのコンテキストを完全に理解するため、TypeScript ファイル (`.ts`) は、そのサイズに関わらず、必ずファイル全体を読み込みます。部分的な読み込みは行いません。

## 依存関係の分析

プロジェクトで利用可能な `npm` パッケージを把握するために、`node_modules` ディレクトリを直接読み込むことはしません。代わりに、以下のファイルの内容を分析します。

- **`package.json`**: プロジェクトが直接依存するパッケージとそのバージョン範囲を確認します。
- **`package-lock.json`**: 間接的な依存関係を含む、実際にインストールされたすべてのパッケージの正確なバージョンツリーを把握します。

このアプローチにより、迅速かつ正確にプロジェクトの依存関係を理解することができます。

### 例外: Minecraft API の型定義

Minecraft の公式 API (`@minecraft/server`, `@minecraft/server-ui` など) に関しては、その型定義ファイル (`.d.ts`) を直接読み込みます。これにより、利用可能な API、クラス、メソッド、イベントの詳細を正確に把握し、開発を円滑に進めることができます。

## コーディング規約

プロジェクト全体のコードの一貫性を保つため、以下の規約に従ってください。

### 1. 命名規則

- **クラス、インターフェース、型エイリアス**: `PascalCase` を使用します。

- **関数、メソッド、変数**: `camelCase` を使用します。

- **定数**: `UPPER_SNAKE_CASE` を使用します。グローバルに共有される不変の値に適用します。

  - 例: `FILL_CHUNK_SIZE_X`

- **ファイル名**: `camelCase.ts` を使用します。

### 2. 設計パターン

- **状態管理クラス (Manager)**: プレイヤーごと、またはグローバルな状態を管理するクラスは、シングルトンパターンまたは静的マップを用いてインスタンスを統一的に管理します。

- **非同期処理**: 大規模な操作は、サーバーのパフォーマンス低下を防ぐため、`system.runJob` とジェネレータ関数を用いてチャンク単位の非同期処理として実装します。これにより、処理が複数のティックに分割され、スクリプトのタイムアウト（Watchdog）を回避します。

### 3. モジュールとインポート/エクスポート

- **エクスポート**: デフォルトエクスポート (`export default`) ではなく、名前付きエクスポート (`export const ...`, `export class ...`) を原則として使用します。これにより、インポート時の名前の揺れを防ぎます。
- **インポート**: モジュールのインポートは、ファイルの先頭にまとめて記述します。

### 4. コメント

- **JSDoc**: 他のファイルから参照されるクラス、メソッド、複雑な関数には、その機能、パラメータ、返り値を説明する JSDoc 形式 (`/** ... */`) のコメントを記述することを推奨します。

## GitHub 運用ルール

### 1. ブランチ戦略

- **main**: 常に安定した、リリース可能な状態を保ちます。直接のコミットは禁止し、Pull Request を通してのみマージします。
- **develop**: 現在開発中のバージョンを管理します。機能開発やバグ修正が完了したブランチは、ここにマージします。
- **feature/`issue-number`-`branch-name`**: 新機能の開発やバグ修正など、個別のタスクごとに作成します。
  - 例: `feature/12-add-sphere-brush`

### 2. コミットメッセージ

コミットメッセージは、変更内容が明確にわかるように、以下の形式で記述します。

```
<type>(<scope>): <subject>

<body>

<footer>
```

- **type**: コミットの種類を表します。
  - `feat`: 新機能の追加
  - `fix`: バグ修正
  - `docs`: ドキュメントの変更
  - `style`: コードスタイルの変更（フォーマットなど）
  - `refactor`: リファクタリング
  - `test`: テストの追加・修正
  - `chore`: ビルドプロセスや補助ツールの変更
- **scope** (任意): 変更が影響する範囲を示します。（例: `commands`, `history`）
- **subject**: 変更内容の簡潔な説明（50 文字以内）。

### 3. Pull Request (PR)

- `develop` ブランチへのマージは、必ず Pull Request を通して行います。
- PR の説明には、実装した内容、関連する Issue 番号（例: `Closes #12`）を記載します。
- PR は、少なくとも 1 人以上のレビューを経てからマージします。

## 主要なワークフロー

1.  **エントリポイント**: `src/main.ts` がアドオンの主要なエントリポイントです。ここで、Minecraft のイベントリスナーが登録され、アドオンの初期化処理が行われます。
2.  **イベント処理**: `main.ts` で登録されたイベントリスナーが、プレイヤーの操作やゲーム内のイベント（例: ブロックの破壊、アイテムの使用、チャットコマンドの実行など）を捕捉します。
3.  **機能モジュール**: 捕捉されたイベントは、それぞれの機能に対応するモジュール（例: コマンド処理、カスタムアイテムのロジックなど）にディスパッチされ、具体的な処理が実行されます。

## ビルドとデプロイ

`package.json` に定義されたスクリプトを使用します。

- `npm run build`: プロジェクトをビルドします。
- `npm run lint`: コードの静的解析を実行します。
- `npm run watch`: ファイル変更を監視し、自動でビルドとデプロイを行います。

## OS間のコマンド差異について

Gemini CLI は、ユーザーの OS 環境 (Windows, macOS, Linux) に応じて、実行するシェルコマンドを使い分ける必要があります。特に、ファイル操作やパスの扱いで問題が発生しやすいため、注意が必要です。

### 発生した問題と解決策

1.  **問題**: `git commit -m "メッセージ"` のように、ダブルクォートで囲んだ日本語メッセージが文字化けしたり、引数として正しく認識されなかったりする。
    *   **解決策**: コミットメッセージを一時ファイルに書き出し、`git commit -F <file>` を使用する。

2.  **問題**: `pwd` コマンド (現在のディレクトリ表示) が Windows に存在しない。
    *   **解決策**: Windows では `cd` コマンド (引数なし) を使用して現在のディレクトリを表示する。

3.  **問題**: `rm` コマンド (ファイル削除) が Windows に存在しない。
    *   **解決策**: Windows では `del` コマンドを使用する。

これらの知見を蓄積し、OS に依存しない安定した操作を目指します。